---
import { Image } from 'astro:assets';
import KlinikLogo from '../assets/images/logos/klinik-logo.png';
---

<header class="relative z-50 bg-background-soft border-b border-gray-200 py-0 px-6">
  <nav aria-label="Primary" class="max-w-7xl mx-auto flex flex-col lg:flex-row items-center justify-between gap-6">
    <!-- Sol: Logo -->
    <div class="flex items-center gap-6">
      <Image 
        src={KlinikLogo}
        alt="Klinik Logo"
        widths={[120, 240]}
        sizes="120px"
        loading="eager"
        class="w-32 h-32 object-contain"
      />
    </div>

    <!-- Sağ: Menü -->
    <ul class="flex flex-wrap items-center justify-center gap-4 lg:gap-6">
      <li>
        <a href="/hakkimda/" class="text-text-primary hover:text-primary transition-colors duration-200 hover:underline">Hakkımda</a>
      </li>

      <!-- Deri Hastalıkları -->
      <li class="relative" id="deri-hastaliklari-menu">
        <a 
          href="/deri-hastaliklari/"
          id="deri-hastaliklari-button"
          class="text-text-primary hover:text-primary transition-colors duration-200 flex items-center focus:outline-none"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Deri Hastalıkları
          <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </a>
        <div 
          id="deri-hastaliklari-dropdown"
          class="absolute hidden bg-white rounded-md shadow-lg mt-2 py-2 w-64 z-50 border border-gray-100 left-0 top-full origin-top-left"
        >
          <a href="/deri-hastaliklari/akne/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Akne (Sivilce) Tedavisi</a>
          <a href="/deri-hastaliklari/egzema/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Egzema Tedavisi</a>
          <a href="/deri-hastaliklari/sedef/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Sedef Hastalığı</a>
          <a href="/deri-hastaliklari/sac-dokulmesi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Saç Dökülmesi Tedavisi</a>
          <a href="/deri-hastaliklari/vitiligo/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Vitiligo Tedavisi</a>
          <a href="/deri-hastaliklari/rozase/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Rozase (Gül Hastalığı)</a>
          <a href="/deri-hastaliklari/urtiker/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Ürtiker (Kurdeşen) Tedavisi</a>
          <a href="/deri-hastaliklari/herpes/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Herpes (Uçuk) Tedavisi</a>
          <a href="/deri-hastaliklari/liken/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Liken Tedavisi</a>
          <a href="/deri-hastaliklari/mantar/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Mantar Tedavisi</a>
        </div>
      </li>

      <!-- Dermokozmetik İşlemler -->
      <li class="relative" id="dermokozmetik-menu">
        <a 
          href="/dermokozmetik/"
          id="dermokozmetik-button"
          class="text-text-primary hover:text-primary transition-colors duration-200 flex items-center focus:outline-none"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Dermokozmetik İşlemler
          <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </a>

        <div 
          id="dermokozmetik-dropdown"
          class="absolute hidden bg-white rounded-md shadow-lg mt-2 py-2 w-64 z-50 border border-gray-100 left-0 top-full origin-top-left"
        >
          <!-- Dolgu -->
          <div class="relative" id="dolgu-menu">
            <button 
              id="dolgu-button"
              class="w-full text-left px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200 flex items-center justify-between"
              aria-haspopup="true"
              aria-expanded="false"
              type="button"
            >
              Dolgu
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            <div 
              id="dolgu-submenu"
              class="absolute hidden bg-white rounded-md shadow-lg py-2 w-48 z-[60] border border-gray-100 left-full top-0 ml-1"
            >
              <a href="/dermokozmetik/dolgu/dudak-dolgusu/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Dudak Dolgusu</a>
              <a href="/dermokozmetik/dolgu/burun-dolgusu/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Burun Dolgusu</a>
              <a href="/dermokozmetik/dolgu/gozalti-isik-dolgusu/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Gözaltı Işık Dolgusu</a>
              <a href="/dermokozmetik/dolgu/cene-dolgusu/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Çene Dolgusu</a>
              <a href="/dermokozmetik/dolgu/elmacik-dolgusu/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Elmacık Dolgusu</a>
            </div>
          </div>

          <!-- Botoks -->
          <div class="relative" id="botoks-menu">
            <button 
              id="botoks-button"
              class="w-full text-left px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200 flex items-center justify-between"
              aria-haspopup="true"
              aria-expanded="false"
              type="button"
            >
              Botoks
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            <div 
              id="botoks-submenu"
              class="absolute hidden bg-white rounded-md shadow-lg py-2 w-48 z-[60] border border-gray-100 left-full top-0 ml-1"
            >
              <a href="/dermokozmetik/botoks/kirisiklik-tedavisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Kırışıklık Tedavisi</a>
              <a href="/dermokozmetik/botoks/dis-sikma-tedavisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Diş Sıkma Tedavisi</a>
              <a href="/dermokozmetik/botoks/terleme-tedavisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Terleme Tedavisi</a>
            </div>
          </div>

          <!-- Mezoterapi -->
          <div class="relative" id="mezoterapi-menu">
            <button 
              id="mezoterapi-button"
              class="w-full text-left px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200 flex items-center justify-between"
              aria-haspopup="true"
              aria-expanded="false"
              type="button"
            >
              Mezoterapi
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            <div 
              id="mezoterapi-submenu"
              class="absolute hidden bg-white rounded-md shadow-lg py-2 w-48 z-[60] border border-gray-100 left-full top-0 ml-1"
            >
              <a href="/dermokozmetik/mezoterapi/paris-isiltisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Paris Işıltısı</a>
              <a href="/dermokozmetik/mezoterapi/leke-mezoterapisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Leke Mezoterapisi</a>
              <a href="/dermokozmetik/mezoterapi/kristal-asi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Kristal Aşı</a>
              <a href="/dermokozmetik/mezoterapi/somon-dna/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Somon DNA</a>
            </div>
          </div>

          <!-- Lazer Tedavileri -->
          <div class="relative" id="lazer-menu">
            <button 
              id="lazer-button"
              class="w-full text-left px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200 flex items-center justify-between"
              aria-haspopup="true"
              aria-expanded="false"
              type="button"
            >
              Lazer Tedavileri
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            <div 
              id="lazer-submenu"
              class="absolute hidden bg-white rounded-md shadow-lg py-2 w-48 z-[60] border border-gray-100 left-full top-0 ml-1"
            >
              <a href="/dermokozmetik/lazer/leke-lazeri/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Leke Lazeri</a>
              <a href="/dermokozmetik/lazer/kirisiklik-lazeri/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Kırışıklık Lazeri</a>
              <a href="/dermokozmetik/lazer/fotona/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Fotona</a>
              <a href="/dermokozmetik/lazer/bbl-hero/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">BBL Hero</a>
            </div>
          </div>

          <!-- Altın İğne -->
          <a href="/dermokozmetik/altin-igne/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Altın İğne</a>

          <!-- Diğer İşlemler -->
          <div class="relative border-t border-gray-100 mt-2 pt-2" id="diger-islemler-menu">
            <button 
              id="diger-islemler-button"
              class="w-full text-left px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200 flex items-center justify-between"
              aria-haspopup="true"
              aria-expanded="false"
              type="button"
            >
              Diğer İşlemler
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            <div 
              id="diger-islemler-submenu"
              class="absolute hidden bg-white rounded-md shadow-lg py-2 w-48 z-[60] border border-gray-100 left-full top-0 ml-1"
            >
              <a href="/dermokozmetik/diger-tedaviler/harmonyca/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">HarmonyCA</a>
              <a href="/dermokozmetik/diger-tedaviler/radiesse/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Radiesse</a>
              <a href="/dermokozmetik/diger-tedaviler/sivi-yuz-germe/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Sıvı Yüz Germe</a>
              <a href="/dermokozmetik/diger-tedaviler/gidi-eritme/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Gıdı Eritme</a>
            </div>
          </div>
        </div>
      </li>

      <!-- Dermatocerrahi -->
      <li class="relative" id="dermatocerrahi-menu">
        <a 
          href="/dermatocerrahi/"
          id="dermatocerrahi-button"
          class="text-text-primary hover:text-primary transition-colors duration-200 flex items-center focus:outline-none"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Dermatocerrahi
          <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </a>
        <div 
          id="dermatocerrahi-dropdown"
          class="absolute hidden bg-white rounded-md shadow-lg mt-2 py-2 w-48 z-50 border border-gray-100 left-0 top-full origin-top-left"
        >
          <a href="/dermatocerrahi/ben-tedavisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Ben Tedavisi</a>
          <a href="/dermatocerrahi/sigil-tedavisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Siğil Tedavisi</a>
          <a href="/dermatocerrahi/kist-tedavisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Kist Tedavisi</a>
          <a href="/dermatocerrahi/kriyoterapi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Kriyoterapi</a>
          <a href="/dermatocerrahi/deri-biyopsisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Deri Biyopsisi</a>
          <a href="/dermatocerrahi/tirnak-cerrahisi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Tırnak Cerrahisi</a>
        </div>
      </li>

      <!-- Deri Kanserleri -->
      <li class="relative" id="deri-kanserleri-menu">
        <a 
          href="/deri-kanserleri/"
          id="deri-kanserleri-button"
          class="text-text-primary hover:text-primary transition-colors duration-200 flex items-center focus:outline-none"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Deri Kanserleri
          <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </a>
        <div 
          id="deri-kanserleri-dropdown"
          class="absolute hidden bg-white rounded-md shadow-lg mt-2 py-2 w-56 z-50 border border-gray-100 left-0 top-full origin-top-left"
        >
          <a href="/deri-kanserleri/malign-melanom/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Malign Melanom</a>
          <a href="/deri-kanserleri/bazal-hucreli-kanser/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Bazal Hücreli Kanser</a>
          <a href="/deri-kanserleri/skuamoz-hucreli-kanser/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Skuamöz Hücreli Kanser</a>
          <a href="/deri-kanserleri/ben-takibi-ve-dermoskopi/" class="block px-4 py-2 text-text-primary hover:bg-background-soft transition-colors duration-200">Ben Takibi ve Dermoskopi</a>
        </div>
      </li>

      <li>
        <a href="/teledermatoloji/" class="text-text-primary hover:text-primary transition-colors duration-200 hover:underline">Online Muayene</a>
      </li>
      <li>
        <a href="/akademik/" class="text-text-primary hover:text-primary transition-colors duration-200 hover:underline">Akademik</a>
      </li>
      <li>
        <a href="/blog/" class="text-text-primary hover:text-primary transition-colors duration-200 hover:underline">Blog</a>
      </li>
      <li>
        <a href="/iletisim/" class="text-text-primary hover:text-primary transition-colors duration-200 hover:underline">İletişim</a>
      </li>
    </ul>
  </nav>
</header>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const isDesktop = () => window.matchMedia('(min-width: 1024px)').matches;

    function setupDropdown({ menuId, buttonId, panelId, hasSubmenus = false }) {
      const menu = document.getElementById(menuId);
      const btn  = document.getElementById(buttonId);
      const panel = document.getElementById(panelId);
      if (!menu || !btn || !panel) return;

      const open = () => { panel.classList.remove('hidden'); btn.setAttribute('aria-expanded', 'true'); };
      const close = () => { panel.classList.add('hidden'); btn.setAttribute('aria-expanded', 'false'); if (hasSubmenus) closeAllSubmenus(); };
      const toggle = () => (panel.classList.contains('hidden') ? open() : close());

      // Hover (sadece desktop)
      menu.addEventListener('mouseenter', () => { if (isDesktop()) open(); });
      menu.addEventListener('mouseleave', () => { if (isDesktop()) setTimeout(() => {
        if (!panel.matches(':hover') && !btn.matches(':hover')) close();
      }, 100); });

      // Click: mobilde toggle, desktopta navigate
      btn.addEventListener('click', (e) => {
        if (!isDesktop()) {
          e.preventDefault();
          e.stopPropagation();
          toggle();
        }
      });

      // Dışa tıklama ile kapat
      document.addEventListener('click', (e) => {
        if (!menu.contains(e.target)) close();
      });
    }

    function setupSubmenu(menuId, buttonId, panelId) {
      const menu = document.getElementById(menuId);
      const btn  = document.getElementById(buttonId);
      const panel = document.getElementById(panelId);
      if (!menu || !btn || !panel) return;

      const open = () => { panel.classList.remove('hidden'); btn.setAttribute('aria-expanded', 'true'); };
      const close = () => { panel.classList.add('hidden'); btn.setAttribute('aria-expanded', 'false'); };
      const toggle = () => (panel.classList.contains('hidden') ? open() : close());

      // Hover (desktop)
      menu.addEventListener('mouseenter', () => { if (isDesktop()) open(); });
      menu.addEventListener('mouseleave', () => { if (isDesktop()) setTimeout(() => {
        if (!panel.matches(':hover') && !btn.matches(':hover')) close();
      }, 100); });

      // Click (mobil)
      btn.addEventListener('click', (e) => {
        if (!isDesktop()) {
          e.preventDefault();
          e.stopPropagation();
          toggle();
        }
      });

      // Dışa tıklama
      document.addEventListener('click', (e) => {
        if (!menu.contains(e.target)) close();
      });
    }

    function closeAllSubmenus() {
      ['dolgu-submenu','botoks-submenu','mezoterapi-submenu','lazer-submenu','diger-islemler-submenu'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
      });
      ['dolgu-button','botoks-button','mezoterapi-button','lazer-button','diger-islemler-button'].forEach(id => {
        const b = document.getElementById(id);
        if (b) b.setAttribute('aria-expanded','false');
      });
    }

    // ÜST MENÜLER
    setupDropdown({ menuId: 'deri-hastaliklari-menu', buttonId: 'deri-hastaliklari-button', panelId: 'deri-hastaliklari-dropdown' });
    setupDropdown({ menuId: 'dermokozmetik-menu',    buttonId: 'dermokozmetik-button',    panelId: 'dermokozmetik-dropdown', hasSubmenus: true });
    setupDropdown({ menuId: 'dermatocerrahi-menu',   buttonId: 'dermatocerrahi-button',   panelId: 'dermatocerrahi-dropdown' });
    setupDropdown({ menuId: 'deri-kanserleri-menu',  buttonId: 'deri-kanserleri-button',  panelId: 'deri-kanserleri-dropdown' });

    // ALT MENÜLER
    setupSubmenu('dolgu-menu',         'dolgu-button',         'dolgu-submenu');
    setupSubmenu('botoks-menu',        'botoks-button',        'botoks-submenu');
    setupSubmenu('mezoterapi-menu',    'mezoterapi-button',    'mezoterapi-submenu');
    setupSubmenu('lazer-menu',         'lazer-button',         'lazer-submenu');
    setupSubmenu('diger-islemler-menu','diger-islemler-button','diger-islemler-submenu');
  });
</script>
